{% extends "examiner_base.html" %}

{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
{% endblock %}

{% block content %}
<h4>Informacje o kursie</h4>
<p>Nazwa kursu:<b> {{course.name}}</b></p>
{% if course.category != "" %}
<p>Kategoria:<b> {{course.category}}</b></p>
{% endif %}
<table class="table">
  <tbody>
    <tr>
      <td>Typ pytań:<b>{% if course.multiple_answer_questions == True %}</b>
            wielokrotnego wyboru
          {% elif course.multiple_answer_questions == False %}
            jednokrotnego wyboru
          {% else %}{% endif %}</td>
      <td>Ilość podejść: <b>{{course.attempt_amount}}</b></td>
    </tr>
    <tr>
      <td>Czas trwania testu:<b>{% if course.time == 0 %}Nieograniczony{% else %} {{course.time}} minut{% endif %}</b></td>
      <td>Całkowita ilość pytań:<b> {{questions|length}}</b></td>
    </tr>
    <tr>
      <td>Ilość pytań podawana studentowi w czasie testu:<b> {{course.question_amount}}</b></td>
      <td>Wymagan ilość poprawnych odpowiedzi:<b>{{course.passing_score}}</b></td>
    </tr>
    <tr>
      <td>Ilość lekcji:<b> {{lessons|length}}</b></td>
      <td>Ilość studentów zapisanych na kurs:<b> {{students|length}}</b></td>
    </tr>
  </tbody>
</table>
{% if course.test_ready %}
  <p>Status testu:<b>Test gotowy</b></p>
{% else %}
  <p>Status testu:<b>Test niegotowy</b></p>
{% endif %}
<hr>
<h4>Statystyki</h4>
Ilość uczniów którzy ukończyli kurs: <b>{{course_information.passed_students}}</b><br>
Ilość uczniów którzy zakończyli test niepowodzeniem: <b>{{course_information.failed_students}}</b><br>
Ilość uczniów którzy są w trakcie kursu: <b>{{course_information.current_students}}</b><br>
Ilość pomyślnych podejść do testu: <b>{{course_information.passed_results}}</b><br>
Ilość niepomyślnych podejść do testu: <b>{{course_information.failed_results}}</b><br><br>
<div class="row">
  <div class="col-sm-3">    
    <canvas id="myChart1"></canvas>
  </div>
  <div class="col-sm-3">    
    <canvas id="myChart2" width="100" height="100"></canvas>
  </div>
</div>
<hr>
<p><b>Ilość studentów zapisanych na kurs:</b> {{students|length}}</p>
<p> Lista studentów</p>
<table class="table">
  <thead class="thead-dark">
    <tr>
      <th width="20%" scope="col" onclick="sortColumn('name')">Student</th>
      <th width="20%" scope="col" onclick="sortColumn('status')">Status</th>
      <th></th>
    </tr>
  </thead>
  <tbody id="tbody">
        
  </tbody>
</table>
<a href="{% url 'examiner_user:results' %}">
  <button class = "btn btn-success">
    Wróć
  </button>
</a>
<script>
  let test_marks = []
</script>
{% for mark in test_marks %}
<script>
  test_marks.push("{{mark}}")
</script>
{% endfor %}
<script>
  let objectList = [];
  function loadTableData(objectList) {
  const tableBody = document.getElementById("tbody");
  let dataHtml = ""
  for (let object of objectList) {
    if (String(object.status) === "Zaliczony") {
      dataHtml += `<tr><td>${object.name}</td><td>${object.status}</td><td><a href="{% url 'student:diploma' student = ${object.pk} pk=course.pk slug=course.name|slugify %}"><button class = "btn btn-success">Dyplom</button></a></td></tr>`
    }
    else {
      dataHtml += `<tr><td>${object.name}</td><td>${object.status}</td></tr>`
    }
    
  };
  tableBody.innerHTML = dataHtml;
};
</script>
{% for student in students %}
<script>
  objectList.push({"name" : "<a href='{% url 'examiner_user:results-course-student' course=course.pk student=student.pk %}''>{{student.username}}</a>",
    "status" : test_marks[Number("{{forloop.counter}}")-1], "sort_status" : test_marks[Number("{{forloop.counter}}")-1],
    "sort_name" : "{{student.username}}", "pk" : "{{student.pk}}", "sort_pk" : "{{student.pk}}"
     })
</script>
{% endfor %}
<script>
  let pass_list = [];
  let pass_no = [];
  let student_list = [];
  let student_no = [];
</script>
{% for label in pass_list %}
<script>
  pass_list.push("{{label}}")
</script>
{% endfor %}
{% for value in pass_no %}
<script>
  pass_no.push(Number("{{value}}"))
</script>
{% endfor %}
{% for label in student_list %}
<script>
  student_list.push("{{label}}")
</script>
{% endfor %}
{% for value in student_no %}
<script>
  student_no.push(Number("{{value}}"))
</script>
{% endfor %}
<script>
const ctx = document.getElementById('myChart1').getContext('2d');
const myChart = new Chart(ctx, {
    type: 'pie',
    data: {
        labels: pass_list,
        datasets: [{
            label: null,
            data: pass_no,
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
});
const ctx2 = document.getElementById('myChart2').getContext('2d');
const myChart2 = new Chart(ctx2, {
    type: 'bar',
    data: {
        labels: student_list,
        datasets: [{
            label: '% wyniku',
            data: student_no,
            backgroundColor: [
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
});
</script>
{% load static %}
<script src="{% static 'js/table_sorting.js' %}"></script>
{% endblock %}