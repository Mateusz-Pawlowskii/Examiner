{% extends "examiner_base.html" %}

{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
{% endblock %}

{% block content %}
<h4>Informacje o kursie</h4>
<p>Nazwa kursu:<b> {{course.name}}</b></p>
{% if course.category != "" %}
<p>Kategoria:<b> {{course.category}}</b></p>
{% endif %}
<table class="table">
  <tbody>
    <tr>
      <td>Typ pytań:<b>{% if course.multiple_answer_questions == True %}</b>
            wielokrotnego wyboru
          {% elif course.multiple_answer_questions == False %}
            jednokrotnego wyboru
          {% else %}{% endif %}</td>
      <td>Ilość podejść: <b>{{course.attempt_amount}}</b></td>
    </tr>
    <tr>
      <td>Czas trwania testu:<b>{% if course.time == 0 %}Nieograniczony{% else %} {{course.time}} minut{% endif %}</b></td>
      <td>Całkowita ilość pytań:<b> {{questions|length}}</b></td>
    </tr>
    <tr>
      <td>Ilość pytań podawana studentowi w czasie testu:<b> {{course.question_amount}}</b></td>
      <td>Wymagan ilość poprawnych odpowiedzi:<b>{{course.passing_score}}</b></td>
    </tr>
    <tr>
      <td>Ilość lekcji:<b> {{lessons|length}}</b></td>
      <td>Ilość studentów zapisanych na kurs:<b> {{course_information.student_amount}}</b></td>
    </tr>
  </tbody>
</table>
{% if course.test_ready %}
  <p>Status testu:<b>Test gotowy</b></p>
{% else %}
  <p>Status testu:<b>Test niegotowy</b></p>
{% endif %}
<hr>
<h4>Statystyki</h4>
Ilość uczniów którzy ukończyli kurs: <b>{{course_information.passed_students}}</b><br>
Ilość uczniów którzy zakończyli test niepowodzeniem: <b>{{course_information.failed_students}}</b><br>
Ilość uczniów którzy są w trakcie kursu: <b>{{course_information.current_students}}</b><br>
Ilość pomyślnych podejść do testu: <b>{{course_information.passed_results}}</b><br>
Ilość niepomyślnych podejść do testu: <b>{{course_information.failed_results}}</b><br><br>
<hr>
<div class="row">
  <div class="col-sm-3">    
    <canvas id="myChart1"></canvas>
  </div>
  <div class="col-sm-3">    
    <canvas id="myChart2" width="100" height="100"></canvas>
  </div>
</div>
<hr>
<p><b>Ilość studentów zapisanych na kurs:</b> {{students|length}}</p>
<p>Poszczególne grupy studenckie zapisane do kursu:</p>
{% for group in groups %}
<p><a href="{% url 'examiner_user:results-course-group' course=course.pk group=group.pk %}">{{group.name}}</a></p>
{% endfor %}
<a href="{% url 'examiner_user:results' %}">
  <button class = "btn btn-success myButton">
    Wróć
  </button>
</a>
<p> Lista wszystkich studentów</p>
<table class="table">
  <thead class="thead-dark">
    <tr>
      {% load static %}
      <th width="20%" scope="col" onclick="sortColumn('name',1)">Student <img id="img1" src="{% static 'img/sorting_button.png' %}"></th>
      <th width="20%" scope="col" onclick="sortColumn('status',2)">Status <img id="img2" src="{% static 'img/sorting_button.png' %}"></th>
      <th scope="col" onclick="sortColumn('grade',3)">{% if grades %}Ocena{% else %}%{% endif %} <img id="img3" src="{% static 'img/sorting_button.png' %}"></th>
      <th></th>
    </tr>
  </thead>
  <tbody id="tbody">
        
  </tbody>
</table>
<script>
  let test_marks = [];
  let grades_list = [];
  let columnNum = 4;
  let grades = true;
</script>
{% if not grades %}
<script>
   grades = false;
</script>
{% endif %}
{% for mark in test_marks %}
<script>
    test_marks.push("{{mark}}")
</script>
{% endfor %}
{% for grade in grades_list %}
<script>
  if (grades) {
    var grade = "{{grade}}";
  } else {
    var grade = Math.round(Number("{{grade}}"));
    if (isNaN(grade)) grade = 0;
  }
  grades_list.push(grade)
</script>
{% endfor %}
<script>
  let objectList = [];
  function loadTableData(objectList) {
    const tableBody = document.getElementById(`tbody`);
    let dataHtml = ""
    for (let object of objectList) {
      if (String(object.status) === "Zaliczony") {
        dataHtml += `<tr><td>${object.name}</td><td>${object.status}</td>
          {% if grades_list|length != 0 %}<td>${object.grade}</td>{% endif %}
          <td><a href="/student/diploma/{{course.pk}}/${object.pk}/{{course.name|slugify}}">
          <button class = "btn btn-success">Dyplom</button></a></td></tr>`
      }
      else {
        dataHtml += `<tr><td>${object.name}</td><td>${object.status}</td>
          {% if grades_list|length != 0 %}<td>${object.grade}</td>{% endif %}</tr>`
      }
      
    };
    tableBody.innerHTML = dataHtml;
  };
</script>
{% for student in students %}
<script>
  objectList.push({"name" : "<a href='{% url 'examiner_user:results-course-student' course=course.pk student=student.0 %}''>{{student.1}}</a>",
    "status" : test_marks[Number("{{student.3}}")], "sort_status" : test_marks[Number("{{student.3}}")],
    "sort_name" : "{{student.1}}", "pk" : "{{student.0}}", "grade" : grades_list[Number("{{forloop.counter0}}")],
    "sort_grade" : grades_list[Number("{{forloop.counter0}}")]
     })
</script>
{% endfor %}
<script>
  let pass_list = [];
  let pass_no = [];
  let student_list = [];
  let student_no = [];
</script>
{% for label in pass_list %}
<script>
  pass_list.push("{{label}}")
</script>
{% endfor %}
{% for value in pass_no %}
<script>
  pass_no.push(Number("{{value}}"))
</script>
{% endfor %}
{% for label in student_list %}
<script>
  student_list.push("{{label}}")
</script>
{% endfor %}
{% for value in student_no %}
<script>
  student_no.push(Number("{{value}}"))
</script>
{% endfor %}
<script>
const ctx = document.getElementById('myChart1').getContext('2d');
const myChart = new Chart(ctx, {
    type: 'pie',
    data: {
        labels: pass_list,
        datasets: [{
            label: null,
            data: pass_no,
            backgroundColor: [
                'rgba(0, 255, 0, 0.2)',
                'rgba(255, 0, 0, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(0, 255, 0, 1)',
                'rgba(255, 0, 0, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
});
const ctx2 = document.getElementById('myChart2').getContext('2d');
const myChart2 = new Chart(ctx2, {
    type: 'bar',
    data: {
        labels: student_list,
        datasets: [{
            label: '% wyniku',
            data: student_no,
            backgroundColor: [
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
});
</script>
<script src="{% static 'js/table_sorting.js' %}"></script>
<script src="{% static 'js/course_search.js' %}"></script>
{% endblock %}